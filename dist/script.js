"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var WorkHoursTable = /*#__PURE__*/function () {
  function WorkHoursTable(id, wrapId, start, end) {
    _classCallCheck(this, WorkHoursTable);

    this.beginTime = start ? start : '08:00';
    this.endTime = end ? end : '23:00';
    this.timeOut = 350;
    this.tableId = id;
    this.wrapId = document.getElementById(wrapId); //Save context for method

    this.changeInterval = this.changeInterval.bind(this);
  }

  _createClass(WorkHoursTable, [{
    key: "createTable",
    value: function createTable() {
      //Create time fields
      this.createInput(this.wrapId, this.beginTime, this.tableId + 'start_interval');
      this.createInput(this.wrapId, this.endTime, this.tableId + 'end_interval');
      var wrap = document.createElement('div');
      wrap.id = this.tableId;
      wrap.classList.add('table__wrap');
      this.wrapId.append(wrap);
      this.redrawTable(wrap, this.beginTime, this.endTime);
    }
  }, {
    key: "createCell",
    value: function createCell() {
      var cell = document.createElement('div');
      cell.classList.add('table__cell');
      cell.classList.add('active');
      cell.addEventListener("click", this.toggleClass, false);
      return cell;
    }
  }, {
    key: "createRow",
    value: function createRow(wrap, day, count) {
      var row = document.createElement('div');
      row.classList.add('table__row');
      var firstCell = document.createElement('div');
      firstCell.classList.add('table__cell');
      firstCell.classList.add('table__cell--days');
      firstCell.innerHTML = "".concat(day);
      row.append(firstCell);

      for (var i = 0; i < count; i++) {
        var cell = this.createCell();
        row.append(cell);
      }

      wrap.append(row);
    }
  }, {
    key: "createInput",
    value: function createInput(wrap, value, id) {
      var input = document.createElement('input');
      input.id = id;
      input.type = 'time';
      input.min = '00:00';
      input.max = '23:30';
      input.value = value;
      input.addEventListener("change", this.changeInterval, false);
      wrap.append(input);
    }
  }, {
    key: "calculateInterval",
    value: function calculateInterval(from, to) {
      var starts = from.split(':');
      var ends = to.split(':');
      return Number(ends[0]) - Number(starts[0]);
    }
  }, {
    key: "redrawTable",
    value: function redrawTable(wrap, start, end) {
      var count = this.calculateInterval(start, end);
      var days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];

      if (count > 0) {
        for (var i = 0; i < 7; i++) {
          this.createRow(wrap, days[i], count);
        }
      }
    }
  }, {
    key: "recalculateRows",
    value: function recalculateRows(start, end) {
      var table = document.getElementById(this.tableId);
      var rows = table.querySelectorAll('.table__row');
      var count = this.calculateInterval(start, end);

      if (count <= 0) {
        return;
      }

      for (var r = 0; r < rows.length; r++) {
        var cells = rows[r].querySelectorAll('.table__cell');

        if (count < cells.length) {
          for (var i = cells.length - 1; i > count; i--) {
            cells[i].remove();
          }
        } else if (count >= cells.length) {
          for (var _i = cells.length - 1; _i < count; _i++) {
            var cell = document.createElement('div');
            cell.classList.add('table__cell');
            cell.classList.add('active');
            cell.addEventListener("click", this.toggleClass, false);
            rows[r].append(cell);
          }
        }
      }
    }
  }, {
    key: "clearTable",
    value: function clearTable() {
      var _this = this;

      var table = document.getElementById(this.tableId);
      var rows = table.querySelectorAll('.table__row');

      for (var i = 0; i < rows.length; i++) {
        var cells = rows[i].querySelectorAll('.table__cell');
        var aliceTumbling = [{
          transform: 'rotate(0) translate3D(-50%, -50%, 0',
          color: '#000'
        }, {
          color: '#431236',
          offset: 0.3
        }, {
          transform: 'rotate(360deg) translate3D(-50%, -50%, 0)',
          color: '#000'
        }];
        var aliceTiming = {
          duration: this.timeOut,
          iterations: 1
        };
        cells.forEach(function (elem) {
          elem.classList.add('hide'); //elem.animate(aliceTumbling, aliceTiming);

          setTimeout(function () {
            elem.remove();
          }, _this.timeOut);
        });
      }
    }
  }, {
    key: "toggleClass",
    value: function toggleClass(e) {
      e.target.classList.toggle('active');
    }
  }, {
    key: "changeInterval",
    value: function changeInterval(e) {
      if (e.target.id === this.tableId + 'start_interval') {
        this.beginTime = e.target.value;
      }

      if (e.target.id === this.tableId + 'end_interval') {
        this.endTime = e.target.value;
      }

      this.recalculateRows(this.beginTime, this.endTime);
    }
  }]);

  return WorkHoursTable;
}();

var table = new WorkHoursTable('work_hours_table', 'main_wrap');
table.createTable(); //const table2 = new WorkHoursTable('work_hours_table2', 'main_wrap');
//table2.createTable();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3NjcmlwdC5qcyJdLCJuYW1lcyI6WyJXb3JrSG91cnNUYWJsZSIsImlkIiwid3JhcElkIiwic3RhcnQiLCJlbmQiLCJiZWdpblRpbWUiLCJlbmRUaW1lIiwidGltZU91dCIsInRhYmxlSWQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiY2hhbmdlSW50ZXJ2YWwiLCJiaW5kIiwiY3JlYXRlSW5wdXQiLCJ3cmFwIiwiY3JlYXRlRWxlbWVudCIsImNsYXNzTGlzdCIsImFkZCIsImFwcGVuZCIsInJlZHJhd1RhYmxlIiwiY2VsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0b2dnbGVDbGFzcyIsImRheSIsImNvdW50Iiwicm93IiwiZmlyc3RDZWxsIiwiaW5uZXJIVE1MIiwiaSIsImNyZWF0ZUNlbGwiLCJ2YWx1ZSIsImlucHV0IiwidHlwZSIsIm1pbiIsIm1heCIsImZyb20iLCJ0byIsInN0YXJ0cyIsInNwbGl0IiwiZW5kcyIsIk51bWJlciIsImNhbGN1bGF0ZUludGVydmFsIiwiZGF5cyIsImNyZWF0ZVJvdyIsInRhYmxlIiwicm93cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJyIiwibGVuZ3RoIiwiY2VsbHMiLCJyZW1vdmUiLCJhbGljZVR1bWJsaW5nIiwidHJhbnNmb3JtIiwiY29sb3IiLCJvZmZzZXQiLCJhbGljZVRpbWluZyIsImR1cmF0aW9uIiwiaXRlcmF0aW9ucyIsImZvckVhY2giLCJlbGVtIiwic2V0VGltZW91dCIsImUiLCJ0YXJnZXQiLCJ0b2dnbGUiLCJyZWNhbGN1bGF0ZVJvd3MiLCJjcmVhdGVUYWJsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7SUFBTUEsYztBQUVGLDBCQUFZQyxFQUFaLEVBQWdCQyxNQUFoQixFQUF3QkMsS0FBeEIsRUFBK0JDLEdBQS9CLEVBQW9DO0FBQUE7O0FBQ2hDLFNBQUtDLFNBQUwsR0FBaUJGLEtBQUssR0FBR0EsS0FBSCxHQUFXLE9BQWpDO0FBQ0EsU0FBS0csT0FBTCxHQUFlRixHQUFHLEdBQUdBLEdB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TUFBQUEsQ0FBQyxDQUFDQyxNQUFGLENBQVM5QyxTQUFULENBQW1CK0MsTUFBbkIsQ0FBMEIsUUFBMUI7QUFDSDs7O21DQUVjRixDLEVBQUU7QUFDYixVQUFHQSxDQUFDLENBQUNDLE1BQUYsQ0FBUzdELEVBQVQsS0FBZ0IsS0FBS08sT0FBTCxHQUFlLGdCQUFsQyxFQUFtRDtBQUMvQyxhQUFLSCxTQUFMLEdBQWlCd0QsQ0FBQyxDQUFDQyxNQUFGLENBQVNoQyxLQUExQjtBQUNIOztBQUNELFVBQUcrQixDQUFDLENBQUNDLE1BQUYsQ0FBUzdELEVBQVQsS0FBZ0IsS0FBS08sT0FBTCxHQUFlLGNBQWxDLEVBQWlEO0FBQzdDLGFBQUtGLE9BQUwsR0FBZXVELENBQUMsQ0FBQ0MsTUFBRixDQUFTaEMsS0FBeEI7QUFDSDs7QUFDRCxXQUFLa0MsZUFBTCxDQUFxQixLQUFLM0QsU0FBMUIsRUFBcUMsS0FBS0MsT0FBMUM7QUFDSDs7Ozs7O0FBSUwsSUFBTXNDLEtBQUssR0FBRyxJQUFJNUMsY0FBSixDQUFtQixrQkFBbkIsRUFBdUMsV0FBdkMsQ0FBZDtBQUNBNEMsS0FBSyxDQUFDcUIsV0FBTixHLENBQ0E7QUFDQSIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBXb3JrSG91cnNUYWJsZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoaWQsIHdyYXBJZCwgc3RhcnQsIGVuZCkge1xyXG4gICAgICAgIHRoaXMuYmVnaW5UaW1lID0gc3RhcnQgPyBzdGFydCA6ICcwODowMCdcclxuICAgICAgICB0aGlzLmVuZFRpbWUgPSBlbmQgPyBlbmQgOiAnMjM6MDAnXHJcbiAgICAgICAgdGhpcy50aW1lT3V0ID0gMzUwO1xyXG4gICAgICAgIHRoaXMudGFibGVJZCA9IGlkO1xyXG4gICAgICAgIHRoaXMud3JhcElkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQod3JhcElkKTtcclxuICAgICAgICAvL1NhdmUgY29udGV4dCBmb3IgbWV0aG9kXHJcbiAgICAgICAgdGhpcy5jaGFuZ2VJbnRlcnZhbCA9IHRoaXMuY2hhbmdlSW50ZXJ2YWwuYmluZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVUYWJsZSgpe1xyXG4gICAgICAgIC8vQ3JlYXRlIHRpbWUgZmllbGRzXHJcbiAgICAgICAgdGhpcy5jcmVhdGVJbnB1dCh0aGlzLndyYXBJZCwgdGhpcy5iZWdpblRpbWUsIHRoaXMudGFibGVJZCArICdzdGFydF9pbnRlcnZhbCcpO1xyXG4gICAgICAgIHRoaXMuY3JlYXRlSW5wdXQodGhpcy53cmFwSWQsIHRoaXMuZW5kVGltZSwgdGhpcy50YWJsZUlkICsgJ2VuZF9pbnRlcnZhbCcpO1xyXG4gICAgICAgIGNvbnN0IHdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB3cmFwLmlkID0gdGhpcy50YWJsZUlkO1xyXG4gICAgICAgIHdyYXAuY2xhc3NMaXN0LmFkZCgndGFibGVfX3dyYXAnKTtcclxuICAgICAgICB0aGlzLndyYXBJZC5hcHBlbmQod3JhcCk7XHJcbiAgICAgICAgdGhpcy5yZWRyYXdUYWJsZSh3cmFwLCB0aGlzLmJlZ2luVGltZSwgdGhpcy5lbmRUaW1lKVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNlbGwoKXtcclxuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy50b2dnbGVDbGFzcywgZmFsc2UpO1xyXG5cclxuICAgICAgICByZXR1cm4gY2VsbDtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVSb3cod3JhcCwgZGF5LCBjb3VudCl7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19yb3cnKTtcclxuICAgICAgICBjb25zdCBmaXJzdENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBmaXJzdENlbGwuY2xhc3NMaXN0LmFkZCgndGFibGVfX2NlbGwnKTtcclxuICAgICAgICBmaXJzdENlbGwuY2xhc3NMaXN0LmFkZCgndGFibGVfX2NlbGwtLWRheXMnKTtcclxuICAgICAgICBmaXJzdENlbGwuaW5uZXJIVE1MID0gYCR7ZGF5fWA7XHJcbiAgICAgICAgcm93LmFwcGVuZChmaXJzdENlbGwpO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IGNvdW50O2krKyl7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLmNyZWF0ZUNlbGwoKTtcclxuICAgICAgICAgICAgcm93LmFwcGVuZChjZWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgd3JhcC5hcHBlbmQocm93KTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVJbnB1dCh3cmFwLCB2YWx1ZSwgaWQpe1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICBpbnB1dC5pZCA9IGlkO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSAndGltZSc7XHJcbiAgICAgICAgaW5wdXQubWluID0gJzAwOjAwJztcclxuICAgICAgICBpbnB1dC5tYXggPSAnMjM6MzAnO1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLmNoYW5nZUludGVydmFsLCBmYWxzZSk7XHJcbiAgICAgICAgd3JhcC5hcHBlbmQoaW5wdXQpO1xyXG4gICAgfVxyXG5cclxuICAgIGNhbGN1bGF0ZUludGVydmFsKGZyb20sIHRvKXtcclxuICAgICAgICBjb25zdCBzdGFydHMgPSBmcm9tLnNwbGl0KCc6Jyk7XHJcbiAgICAgICAgY29uc3QgZW5kcyA9IHRvLnNwbGl0KCc6Jyk7XHJcblxyXG4gICAgICAgIHJldHVybiBOdW1iZXIoZW5kc1swXSkgLSBOdW1iZXIoc3RhcnRzWzBdKVxyXG4gICAgfVxyXG5cclxuICAgIHJlZHJhd1RhYmxlKHdyYXAsIHN0YXJ0LCBlbmQpe1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jYWxjdWxhdGVJbnRlcnZhbChzdGFydCwgZW5kKTtcclxuICAgICAgICBjb25zdCBkYXlzID0gWyfQn9C9JywgJ9CS0YInLCAn0KHRgCcsICfQp9GCJywgJ9Cf0YInLCAn0KHQsScsICfQktGBJ107XHJcbiAgICAgICAgaWYoY291bnQgPiAwKXtcclxuICAgICAgICAgICAgZm9yKGxldCBpID0gMDtpIDwgNztpKyspe1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jcmVhdGVSb3cod3JhcCwgZGF5c1tpXSwgY291bnQpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHJlY2FsY3VsYXRlUm93cyhzdGFydCwgZW5kKXtcclxuICAgICAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudGFibGVJZCk7XHJcbiAgICAgICAgY29uc3Qgcm93cyA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWJsZV9fcm93Jyk7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLmNhbGN1bGF0ZUludGVydmFsKHN0YXJ0LCBlbmQpO1xyXG5cclxuICAgICAgICBpZihjb3VudCA8PSAwKXtyZXR1cm59XHJcblxyXG4gICAgICAgIGZvcihsZXQgciA9IDA7IHIgPCByb3dzLmxlbmd0aDtyKyspIHtcclxuICAgICAgICAgICAgY29uc3QgY2VsbHMgPSByb3dzW3JdLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgICAgICBpZihjb3VudCA8IGNlbGxzLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gY2VsbHMubGVuZ3RoIC0gMTsgaSA+IGNvdW50O2ktLSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxzW2ldLnJlbW92ZSgpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgaWYoY291bnQgPj0gY2VsbHMubGVuZ3RoKXtcclxuICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IGNlbGxzLmxlbmd0aCAtIDE7IGkgPCBjb3VudDtpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy50b2dnbGVDbGFzcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJvd3Nbcl0uYXBwZW5kKGNlbGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBjbGVhclRhYmxlKCl7XHJcbiAgICAgICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRhYmxlSWQpO1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKCcudGFibGVfX3JvdycpO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDtpKyspe1xyXG4gICAgICAgICAgICBjb25zdCBjZWxscyA9IHJvd3NbaV0ucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlX19jZWxsJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IGFsaWNlVHVtYmxpbmcgPSBbXHJcbiAgICAgICAgICAgICAgICB7IHRyYW5zZm9ybTogJ3JvdGF0ZSgwKSB0cmFuc2xhdGUzRCgtNTAlLCAtNTAlLCAwJywgY29sb3I6ICcjMDAwJyB9LFxyXG4gICAgICAgICAgICAgICAgeyBjb2xvcjogJyM0MzEyMzYnLCBvZmZzZXQ6IDAuM30sXHJcbiAgICAgICAgICAgICAgICB7IHRyYW5zZm9ybTogJ3JvdGF0ZSgzNjBkZWcpIHRyYW5zbGF0ZTNEKC01MCUsIC01MCUsIDApJywgY29sb3I6ICcjMDAwJyB9XHJcbiAgICAgICAgICAgIF07XHJcbiAgICAgICAgICAgIGNvbnN0IGFsaWNlVGltaW5nID0ge1xyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IHRoaXMudGltZU91dCxcclxuICAgICAgICAgICAgICAgIGl0ZXJhdGlvbnM6IDFcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjZWxscy5mb3JFYWNoKGVsZW0gPT4ge1xyXG4gICAgICAgICAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdoaWRlJyk7XHJcbiAgICAgICAgICAgICAgICAvL2VsZW0uYW5pbWF0ZShhbGljZVR1bWJsaW5nLCBhbGljZVRpbWluZyk7XHJcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtlbGVtLnJlbW92ZSgpfSwgdGhpcy50aW1lT3V0KVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0b2dnbGVDbGFzcyhlKXtcclxuICAgICAgICBlLnRhcmdldC5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKVxyXG4gICAgfVxyXG5cclxuICAgIGNoYW5nZUludGVydmFsKGUpe1xyXG4gICAgICAgIGlmKGUudGFyZ2V0LmlkID09PSB0aGlzLnRhYmxlSWQgKyAnc3RhcnRfaW50ZXJ2YWwnKXtcclxuICAgICAgICAgICAgdGhpcy5iZWdpblRpbWUgPSBlLnRhcmdldC52YWx1ZVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZihlLnRhcmdldC5pZCA9PT0gdGhpcy50YWJsZUlkICsgJ2VuZF9pbnRlcnZhbCcpe1xyXG4gICAgICAgICAgICB0aGlzLmVuZFRpbWUgPSBlLnRhcmdldC52YWx1ZVxyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnJlY2FsY3VsYXRlUm93cyh0aGlzLmJlZ2luVGltZSwgdGhpcy5lbmRUaW1lKVxyXG4gICAgfVxyXG5cclxufVxyXG5cclxuY29uc3QgdGFibGUgPSBuZXcgV29ya0hvdXJzVGFibGUoJ3dvcmtfaG91cnNfdGFibGUnLCAnbWFpbl93cmFwJyk7XHJcbnRhYmxlLmNyZWF0ZVRhYmxlKCk7XHJcbi8vY29uc3QgdGFibGUyID0gbmV3IFdvcmtIb3Vyc1RhYmxlKCd3b3JrX2hvdXJzX3RhYmxlMicsICdtYWluX3dyYXAnKTtcclxuLy90YWJsZTIuY3JlYXRlVGFibGUoKTtcclxuXHJcbiJdfQ==
