"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var WorkHoursTable = /*#__PURE__*/function () {
  function WorkHoursTable(id, wrapId, start, end) {
    _classCallCheck(this, WorkHoursTable);

    if (!id) {
      throw Error('No table ID');
    }

    if (!wrapId) {
      throw Error('No table wrap ID');
    }

    this.beginTime = start ? start : '00:00';
    this.endTime = end ? end : '23:00';
    this.timeOut = 350;
    this.tableId = id;
    this.wrapId = document.getElementById(wrapId); //Save context for method

    this.changeInterval = this.changeInterval.bind(this);
  }

  _createClass(WorkHoursTable, [{
    key: "createTable",
    value: function createTable() {
      var _this = this;

      //Create time title
      var timeTitle = document.createElement('span');
      timeTitle.classList.add('table__time-title');
      timeTitle.innerText = 'Задать интервал таблицы'; //Create time separator

      var separator = document.createElement('span');
      separator.classList.add('table__time-separator'); //Create time fields

      var inputStart = this.createInput(this.beginTime, this.tableId + 'start_interval');
      var inputEnd = this.createInput(this.endTime, this.tableId + 'end_interval'); //Create wrapper

      var wrap = document.createElement('div');
      wrap.id = this.tableId;
      wrap.classList.add('table__wrap'); //Create time-title wrap

      var timeTitleWrap = document.createElement('div');
      timeTitleWrap.classList.add('table__time-title-wrap'); //Create buttons wrap

      var buttonsWrap = document.createElement('div');
      buttonsWrap.classList.add('table__buttons-wrap');
      var buttonFill = this.createButton('Заполнить автоматически');
      var buttonClear = this.createButton('Очистить');
      buttonClear.addEventListener("click", function () {
        return _this.fillActiveHours(true);
      }, false);
      buttonFill.addEventListener("click", function () {
        return _this.fillActiveHours();
      }, false); //Append blocks

      timeTitleWrap.append(timeTitle);
      timeTitleWrap.append(inputStart);
      timeTitleWrap.append(separator);
      timeTitleWrap.append(inputEnd);
      buttonsWrap.append(buttonFill);
      buttonsWrap.append(buttonClear);
      this.wrapId.append(timeTitleWrap);
      this.wrapId.append(wrap);
      this.wrapId.append(buttonsWrap); //Render table

      this.redrawTable(wrap, this.beginTime, this.endTime);
    }
  }, {
    key: "createCell",
    value: function createCell() {
      var cell = document.createElement('div');
      cell.classList.add('table__cell');
      cell.addEventListener("click", this.toggleClass, false);
      return cell;
    }
  }, {
    key: "createRow",
    value: function createRow(day, count) {
      var row = document.createElement('div');
      row.classList.add('table__row');
      var firstCell = document.createElement('div');
      firstCell.classList.add('table__cell');
      firstCell.classList.add('table__cell--days');
      firstCell.innerHTML = "".concat(day);
      row.append(firstCell);

      for (var i = 0; i < count; i++) {
        var cell = this.createCell();
        row.append(cell);
      }

      return row;
    }
  }, {
    key: "createHoursRow",
    value: function createHoursRow(start, count) {
      var hours = ['00', '01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23'];
      var hoursCircle = hours.concat.apply(hours, hours);
      var startHour = start.split(':');
      var startPoint = hoursCircle.indexOf(startHour[0]); //create row

      var row = document.createElement('div');
      row.classList.add('table__row');
      row.classList.add('table__row--hours'); //create first cell

      var firstCell = document.createElement('div');
      firstCell.classList.add('table__cell');
      firstCell.classList.add('table__cell--days'); //append blocks

      row.append(firstCell);

      for (var i = startPoint; i < startPoint + count; i++) {
        //create default hour cell
        var cell = document.createElement('div');
        cell.classList.add('table__cell');
        var minutes = document.createElement('span');
        minutes.classList.add('minutes');
        minutes.innerText = '00';

        if (i % 2 !== 0) {
          cell.innerText = hoursCircle[i];
          cell.append(minutes);
        }

        row.append(cell);
      }

      return row;
    }
  }, {
    key: "createInput",
    value: function createInput(value, id) {
      var input = document.createElement('input');
      input.id = id;
      input.type = 'time';
      input.min = '00:00';
      input.max = '23:30';
      input.value = value;
      input.addEventListener("change", this.changeInterval, false);
      return input;
    }
  }, {
    key: "createButton",
    value: function createButton(text) {
      var button = document.createElement('button');
      button.classList.add('table__button');
      button.type = 'button';
      button.innerText = text;
      return button;
    }
  }, {
    key: "calculateInterval",
    value: function calculateInterval(from, to) {
      var starts = from.split(':');
      var ends = to.split(':');
      var startHour = Number(starts[0]);
      var startMinute = Number(starts[1]);
      var endHour = Number(ends[0]);
      var endMinute = Number(ends[1]); //Night shifts

      if (endHour < startHour) {
        endHour += 24;
      }

      return endHour - startHour;
    }
  }, {
    key: "redrawTable",
    value: function redrawTable(wrap, start, end) {
      var count = this.calculateInterval(start, end);
      var days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];
      var hoursRow = this.createHoursRow(start, count);

      if (count > 0) {
        wrap.append(hoursRow);

        for (var i = 0; i < 7; i++) {
          var row = this.createRow(days[i], count);
          wrap.append(row);
        }
      }
    }
  }, {
    key: "recalculateRows",
    value: function recalculateRows(start, end) {
      var table = document.getElementById(this.tableId);
      var rows = table.querySelectorAll('.table__row');
      var count = this.calculateInterval(start, end);

      if (count <= 0) {
        return;
      }

      var hoursRow = this.createHoursRow(start, count);
      rows[0].remove();
      table.prepend(hoursRow);

      for (var r = 1; r < rows.length; r++) {
        var cells = rows[r].querySelectorAll('.table__cell');

        if (count < cells.length) {
          for (var i = cells.length - 1; i > count; i--) {
            cells[i].remove();
          }
        } else if (count >= cells.length) {
          for (var _i = cells.length - 1; _i < count; _i++) {
            var cell = document.createElement('div');
            cell.classList.add('table__cell');
            cell.addEventListener("click", this.toggleClass, false);
            rows[r].append(cell);
          }
        }
      }
    }
  }, {
    key: "clearTableAnimate",
    value: function clearTableAnimate() {
      var _this2 = this;

      var table = document.getElementById(this.tableId);
      var rows = table.querySelectorAll('.table__row');

      for (var i = 0; i < rows.length; i++) {
        var cells = rows[i].querySelectorAll('.table__cell'); //possible animations

        var aliceTumbling = [{
          transform: 'rotate(0) translate3D(-50%, -50%, 0',
          color: '#000'
        }, {
          color: '#431236',
          offset: 0.3
        }, {
          transform: 'rotate(360deg) translate3D(-50%, -50%, 0)',
          color: '#000'
        }];
        var aliceTiming = {
          duration: this.timeOut,
          iterations: 1
        };
        cells.forEach(function (elem) {
          elem.classList.add('hide'); //elem.animate(aliceTumbling, aliceTiming);

          setTimeout(function () {
            elem.remove();
          }, _this2.timeOut);
        });
      }
    }
  }, {
    key: "fillActiveHours",
    value: function fillActiveHours(clear) {
      var table = document.getElementById(this.tableId);
      var rows = table.querySelectorAll('.table__row');

      for (var r = 1; r < rows.length; r++) {
        var cells = rows[r].querySelectorAll('.table__cell');

        if (clear) {
          for (var i = 1; i < cells.length; i++) {
            cells[i].classList.remove('active');
          }
        } else {
          for (var _i2 = 1; _i2 < cells.length; _i2++) {
            cells[_i2].classList.add('active');
          }
        }
      }
    }
  }, {
    key: "toggleClass",
    value: function toggleClass(e) {
      e.target.classList.toggle('active');
    }
  }, {
    key: "changeInterval",
    value: function changeInterval(e) {
      if (e.target.id === this.tableId + 'start_interval') {
        this.beginTime = e.target.value;
      }

      if (e.target.id === this.tableId + 'end_interval') {
        this.endTime = e.target.value;
      }

      this.recalculateRows(this.beginTime, this.endTime);
    }
  }]);

  return WorkHoursTable;
}();

var table = new WorkHoursTable('work_hours_table', 'main_wrap');
table.createTable(); //const table2 = new WorkHoursTable('work_hours_table2', 'main_wrap');
//table2.createTable();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3NjcmlwdC5qcyJdLCJuYW1lcyI6WyJXb3JrSG91cnNUYWJsZSIsImlkIiwid3JhcElkIiwic3RhcnQiLCJlbmQiLCJFcnJvciIsImJlZ2luVGltZSIsImVuZFRpbWUiLCJ0aW1lT3V0IiwidGFibGVJZCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjaGFuZ2VJbnRlcnZhbCIsImJpbmQiLCJ0aW1lVGl0bGUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiaW5uZXJUZXh0Iiwic2VwYXJhdG9yIiwiaW5wdXRTdGFydCIsImNyZWF0ZUlucHV0IiwiaW5wdXRFbmQiLCJ3cmFwIiwidGltZVRpdGxlV3JhcCIsImJ1dHRvbnNXcmFwIiwiYnV0dG9uRmlsbCIsImNyZWF0ZUJ1dHRvbiIsImJ1dHRvbkNsZWFyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImZpbGxBY3RpdmVIb3VycyIsImFwcGVuZCIsInJlZHJhd1RhYmxlIiwiY2VsbCIsInRvZ2dsZUNsYXNzIiwiZGF5IiwiY291bnQiLCJyb3ciLCJmaXJzdENlbGwiLCJpbm5lckhUTUwiLCJpIiwiY3JlYXRlQ2VsbCIsImhvdXJzIiwiaG91cnNDaXJjbGUiLCJjb25jYXQiLCJzdGFydEhvdXIiLCJzcGxpdCIsInN0YXJ0UG9pbnQiLCJpbmRleE9mIiwibWludXRlcyIsInZhbHVlIiwiaW5wdXQiLCJ0eXBlIiwibWluIiwibWF4IiwidGV4dCIsImJ1dHRvbiIsImZyb20iLCJ0byIsInN0YXJ0cyIsImVuZHMiLCJOdW1iZXIiLCJzdGFydE1pbnV0ZSIsImVuZEhvdXIiLCJlbmRNaW51dGUiLCJjYWxjdWxhdGVJbnRlcnZhbCIsImRheXMiLCJob3Vyc1JvdyIsImNyZWF0ZUhvdXJzUm93IiwiY3JlYXRlUm93IiwidGFibGUiLCJyb3dzIiwicXVlcnlTZWxlY3RvckFsbCIsInJlbW92ZSIsInByZXBlbmQiLCJyIiwibGVuZ3RoIiwiY2VsbHMiLCJhbGljZVR1bWJsaW5nIiwidHJhbnNmb3JtIiwiY29sb3IiLCJvZmZzZXQiLCJhbGljZVRpbWluZyIsImR1cmF0aW9uIiwiaXRlcmF0aW9ucyIsImZvckVhY2giLCJlbGVtIiwic2V0VGltZW91dCIsImNsZWFyIiwiZSIsInRhcmdldCIsInRvZ2dsZSIsInJlY2FsY3VsYXRlUm93cyIsImNyZWF0ZVRhYmxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztJQUFNQSxjO0FBRUYsMEJBQVlDLEVBQVosRUFBZ0JDLE1BQWhCLEVBQXdCQyxLQUF4QixFQUErQkMsR0FBL0IsRUFBb0M7QUFBQTs7QUFDaEMsUUFBRyxDQUFDSCxFQUFKLEVBQU87QUFDSCxZQUFNSSxLQUFLLENBQUMsYUFBRCxDQUFYO0FBQ0g7O0FBQ0QsUUFBRyxDQUFDSCxNQUFKLEVBQVc7QUFDUCxZQUFNRyxLQUFLLENBQUMsa0JBQUQsQ0FBWDtBQUNIOztBQUNELFNBQUtDLFNBQUwsR0FBaUJILEtBQUssR0FBR0EsS0FBSCxHQUFXLE9BQWpDO0FBQ0EsU0FBS0ksT0FBTCxHQUFlSCxHQUFHLEdBQUdBLEdBQUgsR0FBUyxPQUEzQjtBQUNBLFNBQUtJLE9BQUwsR0FBZSxHQUFmO0FBQ0EsU0FBS0MsT0FBTCxHQUFlUixFQUFmO0FBQ0EsU0FBS0MsTUFBTCxHQUFjUSxRQUFRLENBQUNDLGNBQVQsQ0FBd0JULE1BQXhCLENBQWQsQ0FYZ0MsQ0FZaEM7O0FBQ0EsU0FBS1UsY0FBTCxHQUFzQixLQUFLQSxjQUFMLENBQW9CQyxJQUFwQixDQUF5QixJQUF6QixDQUF0QjtBQUNIOzs7O2tDQUVZO0FBQUE7O0FBQ1Q7QUFDQSxVQUFNQyxTQUFTLEdBQUdKLFFBQVEsQ0FBQ0ssYUFBVCxDQUF1QixNQUF2QixDQUFsQjtBQUNBRCxNQUFBQSxTQUFTLENBQUNFLFNBQVYsQ0FBb0JDLEdBQXBCLENBQXdCLG1CQUF4QjtBQUNBSCxNQUFBQSxTQUFTLENBQUNJLFNBQVYsR0FBc0IseUJBQXRCLENBSlMsQ0FLVDs7QUFDQSxVQUFNQyxTQUFTLEdBQUdULFFBQVEsQ0FBQ0ssYUFBVCxDQUF1QixNQUF2QixDQUFs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bkIsQ0FBdUIsUUFBdkI7QUFDSDtBQUNKO0FBRUo7QUFDSjs7O2dDQUVXd0UsQyxFQUFFO0FBQ1ZBLE1BQUFBLENBQUMsQ0FBQ0MsTUFBRixDQUFTMUUsU0FBVCxDQUFtQjJFLE1BQW5CLENBQTBCLFFBQTFCO0FBQ0g7OzttQ0FFY0YsQyxFQUFFO0FBQ2IsVUFBR0EsQ0FBQyxDQUFDQyxNQUFGLENBQVN6RixFQUFULEtBQWdCLEtBQUtRLE9BQUwsR0FBZSxnQkFBbEMsRUFBbUQ7QUFDL0MsYUFBS0gsU0FBTCxHQUFpQm1GLENBQUMsQ0FBQ0MsTUFBRixDQUFTeEMsS0FBMUI7QUFDSDs7QUFDRCxVQUFHdUMsQ0FBQyxDQUFDQyxNQUFGLENBQVN6RixFQUFULEtBQWdCLEtBQUtRLE9BQUwsR0FBZSxjQUFsQyxFQUFpRDtBQUM3QyxhQUFLRixPQUFMLEdBQWVrRixDQUFDLENBQUNDLE1BQUYsQ0FBU3hDLEtBQXhCO0FBQ0g7O0FBQ0QsV0FBSzBDLGVBQUwsQ0FBcUIsS0FBS3RGLFNBQTFCLEVBQXFDLEtBQUtDLE9BQTFDO0FBQ0g7Ozs7OztBQUlMLElBQU0rRCxLQUFLLEdBQUcsSUFBSXRFLGNBQUosQ0FBbUIsa0JBQW5CLEVBQXVDLFdBQXZDLENBQWQ7QUFDQXNFLEtBQUssQ0FBQ3VCLFdBQU4sRyxDQUNBO0FBQ0EiLCJmaWxlIjoic2NyaXB0LmpzIiwic291cmNlc0NvbnRlbnQiOlsiY2xhc3MgV29ya0hvdXJzVGFibGUge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKGlkLCB3cmFwSWQsIHN0YXJ0LCBlbmQpIHtcclxuICAgICAgICBpZighaWQpe1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignTm8gdGFibGUgSUQnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoIXdyYXBJZCl7XHJcbiAgICAgICAgICAgIHRocm93IEVycm9yKCdObyB0YWJsZSB3cmFwIElEJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuYmVnaW5UaW1lID0gc3RhcnQgPyBzdGFydCA6ICcwMDowMCdcclxuICAgICAgICB0aGlzLmVuZFRpbWUgPSBlbmQgPyBlbmQgOiAnMjM6MDAnXHJcbiAgICAgICAgdGhpcy50aW1lT3V0ID0gMzUwO1xyXG4gICAgICAgIHRoaXMudGFibGVJZCA9IGlkO1xyXG4gICAgICAgIHRoaXMud3JhcElkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQod3JhcElkKTtcclxuICAgICAgICAvL1NhdmUgY29udGV4dCBmb3IgbWV0aG9kXHJcbiAgICAgICAgdGhpcy5jaGFuZ2VJbnRlcnZhbCA9IHRoaXMuY2hhbmdlSW50ZXJ2YWwuYmluZCh0aGlzKTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVUYWJsZSgpe1xyXG4gICAgICAgIC8vQ3JlYXRlIHRpbWUgdGl0bGVcclxuICAgICAgICBjb25zdCB0aW1lVGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgdGltZVRpdGxlLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX190aW1lLXRpdGxlJyk7XHJcbiAgICAgICAgdGltZVRpdGxlLmlubmVyVGV4dCA9ICfQl9Cw0LTQsNGC0Ywg0LjQvdGC0LXRgNCy0LDQuyDRgtCw0LHQu9C40YbRiyc7XHJcbiAgICAgICAgLy9DcmVhdGUgdGltZSBzZXBhcmF0b3JcclxuICAgICAgICBjb25zdCBzZXBhcmF0b3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgc2VwYXJhdG9yLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX190aW1lLXNlcGFyYXRvcicpO1xyXG4gICAgICAgIC8vQ3JlYXRlIHRpbWUgZmllbGRzXHJcbiAgICAgICAgY29uc3QgaW5wdXRTdGFydCA9IHRoaXMuY3JlYXRlSW5wdXQodGhpcy5iZWdpblRpbWUsIHRoaXMudGFibGVJZCArICdzdGFydF9pbnRlcnZhbCcpO1xyXG4gICAgICAgIGNvbnN0IGlucHV0RW5kID0gdGhpcy5jcmVhdGVJbnB1dCh0aGlzLmVuZFRpbWUsIHRoaXMudGFibGVJZCArICdlbmRfaW50ZXJ2YWwnKTtcclxuICAgICAgICAvL0NyZWF0ZSB3cmFwcGVyXHJcbiAgICAgICAgY29uc3Qgd3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHdyYXAuaWQgPSB0aGlzLnRhYmxlSWQ7XHJcbiAgICAgICAgd3JhcC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fd3JhcCcpO1xyXG4gICAgICAgIC8vQ3JlYXRlIHRpbWUtdGl0bGUgd3JhcFxyXG4gICAgICAgIGNvbnN0IHRpbWVUaXRsZVdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB0aW1lVGl0bGVXcmFwLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX190aW1lLXRpdGxlLXdyYXAnKTtcclxuICAgICAgICAvL0NyZWF0ZSBidXR0b25zIHdyYXBcclxuICAgICAgICBjb25zdCBidXR0b25zV3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGJ1dHRvbnNXcmFwLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19idXR0b25zLXdyYXAnKTtcclxuICAgICAgICBjb25zdCBidXR0b25GaWxsID0gdGhpcy5jcmVhdGVCdXR0b24oJ9CX0LDQv9C+0LvQvdC40YLRjCDQsNCy0YLQvtC80LDRgtC40YfQtdGB0LrQuCcpO1xyXG4gICAgICAgIGNvbnN0IGJ1dHRvbkNsZWFyID0gdGhpcy5jcmVhdGVCdXR0b24oJ9Ce0YfQuNGB0YLQuNGC0YwnKTtcclxuICAgICAgICBidXR0b25DbGVhci5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gdGhpcy5maWxsQWN0aXZlSG91cnModHJ1ZSksIGZhbHNlKTtcclxuICAgICAgICBidXR0b25GaWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB0aGlzLmZpbGxBY3RpdmVIb3VycygpLCBmYWxzZSk7XHJcbiAgICAgICAgLy9BcHBlbmQgYmxvY2tzXHJcbiAgICAgICAgdGltZVRpdGxlV3JhcC5hcHBlbmQodGltZVRpdGxlKTtcclxuICAgICAgICB0aW1lVGl0bGVXcmFwLmFwcGVuZChpbnB1dFN0YXJ0KTtcclxuICAgICAgICB0aW1lVGl0bGVXcmFwLmFwcGVuZChzZXBhcmF0b3IpO1xyXG4gICAgICAgIHRpbWVUaXRsZVdyYXAuYXBwZW5kKGlucHV0RW5kKTtcclxuICAgICAgICBidXR0b25zV3JhcC5hcHBlbmQoYnV0dG9uRmlsbCk7XHJcbiAgICAgICAgYnV0dG9uc1dyYXAuYXBwZW5kKGJ1dHRvbkNsZWFyKTtcclxuICAgICAgICB0aGlzLndyYXBJZC5hcHBlbmQodGltZVRpdGxlV3JhcCk7XHJcbiAgICAgICAgdGhpcy53cmFwSWQuYXBwZW5kKHdyYXApO1xyXG4gICAgICAgIHRoaXMud3JhcElkLmFwcGVuZChidXR0b25zV3JhcCk7XHJcbiAgICAgICAgLy9SZW5kZXIgdGFibGVcclxuICAgICAgICB0aGlzLnJlZHJhd1RhYmxlKHdyYXAsIHRoaXMuYmVnaW5UaW1lLCB0aGlzLmVuZFRpbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNlbGwoKXtcclxuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMudG9nZ2xlQ2xhc3MsIGZhbHNlKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNlbGw7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlUm93KGRheSwgY291bnQpe1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fcm93Jyk7XHJcbiAgICAgICAgY29uc3QgZmlyc3RDZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgZmlyc3RDZWxsLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19jZWxsJyk7XHJcbiAgICAgICAgZmlyc3RDZWxsLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19jZWxsLS1kYXlzJyk7XHJcbiAgICAgICAgZmlyc3RDZWxsLmlubmVySFRNTCA9IGAke2RheX1gO1xyXG4gICAgICAgIHJvdy5hcHBlbmQoZmlyc3RDZWxsKTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwO2kgPCBjb3VudDtpKyspe1xyXG4gICAgICAgICAgICBjb25zdCBjZWxsID0gdGhpcy5jcmVhdGVDZWxsKCk7XHJcbiAgICAgICAgICAgIHJvdy5hcHBlbmQoY2VsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiByb3c7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlSG91cnNSb3coc3RhcnQsIGNvdW50KXtcclxuICAgICAgICBjb25zdCBob3VycyA9IFsnMDAnLCAnMDEnLCAnMDInLCAnMDMnLCAnMDQnLCAnMDUnLCAnMDYnLCAnMDcnLCAnMDgnLCAnMDknLCAnMTAnLCAnMTEnLCAnMTInLCAnMTMnLCAnMTQnLCAnMTUnLCAnMTYnLCAnMTcnLCAnMTgnLCAnMTknLCAnMjAnLCAnMjEnLCAnMjInLCAnMjMnXTtcclxuICAgICAgICBjb25zdCBob3Vyc0NpcmNsZSA9IGhvdXJzLmNvbmNhdCguLi5ob3Vycyk7XHJcbiAgICAgICAgY29uc3Qgc3RhcnRIb3VyID0gc3RhcnQuc3BsaXQoJzonKTtcclxuICAgICAgICBjb25zdCBzdGFydFBvaW50ID0gaG91cnNDaXJjbGUuaW5kZXhPZihzdGFydEhvdXJbMF0pO1xyXG4gICAgICAgIC8vY3JlYXRlIHJvd1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHJvdy5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fcm93Jyk7XHJcbiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19yb3ctLWhvdXJzJyk7XHJcbiAgICAgICAgLy9jcmVhdGUgZmlyc3QgY2VsbFxyXG4gICAgICAgIGNvbnN0IGZpcnN0Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGZpcnN0Q2VsbC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgIGZpcnN0Q2VsbC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fY2VsbC0tZGF5cycpO1xyXG4gICAgICAgIC8vYXBwZW5kIGJsb2Nrc1xyXG4gICAgICAgIHJvdy5hcHBlbmQoZmlyc3RDZWxsKTtcclxuICAgICAgICBmb3IobGV0IGkgPSBzdGFydFBvaW50O2kgPCBzdGFydFBvaW50ICsgY291bnQ7aSsrKXtcclxuICAgICAgICAgICAgLy9jcmVhdGUgZGVmYXVsdCBob3VyIGNlbGxcclxuICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19jZWxsJyk7XHJcbiAgICAgICAgICAgIGNvbnN0IG1pbnV0ZXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7XHJcbiAgICAgICAgICAgIG1pbnV0ZXMuY2xhc3NMaXN0LmFkZCgnbWludXRlcycpO1xyXG4gICAgICAgICAgICBtaW51dGVzLmlubmVyVGV4dCA9ICcwMCc7XHJcbiAgICAgICAgICAgIGlmKGklMiAhPT0gMCl7XHJcbiAgICAgICAgICAgICAgICBjZWxsLmlubmVyVGV4dCA9IGhvdXJzQ2lyY2xlW2ldO1xyXG4gICAgICAgICAgICAgICAgY2VsbC5hcHBlbmQobWludXRlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcm93LmFwcGVuZChjZWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJvdztcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVJbnB1dCh2YWx1ZSwgaWQpe1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICBpbnB1dC5pZCA9IGlkO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSAndGltZSc7XHJcbiAgICAgICAgaW5wdXQubWluID0gJzAwOjAwJztcclxuICAgICAgICBpbnB1dC5tYXggPSAnMjM6MzAnO1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLmNoYW5nZUludGVydmFsLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHJldHVybiBpbnB1dDtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVCdXR0b24odGV4dCl7XHJcbiAgICAgICAgY29uc3QgYnV0dG9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7XHJcbiAgICAgICAgYnV0dG9uLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19idXR0b24nKTtcclxuICAgICAgICBidXR0b24udHlwZSA9ICdidXR0b24nO1xyXG4gICAgICAgIGJ1dHRvbi5pbm5lclRleHQgPSB0ZXh0O1xyXG5cclxuICAgICAgICByZXR1cm4gYnV0dG9uXHJcbiAgICB9XHJcblxyXG4gICAgY2FsY3VsYXRlSW50ZXJ2YWwoZnJvbSwgdG8pe1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0cyA9IGZyb20uc3BsaXQoJzonKTtcclxuICAgICAgICBjb25zdCBlbmRzID0gdG8uc3BsaXQoJzonKTtcclxuICAgICAgICBsZXQgc3RhcnRIb3VyID0gTnVtYmVyKHN0YXJ0c1swXSk7XHJcbiAgICAgICAgbGV0IHN0YXJ0TWludXRlID0gTnVtYmVyKHN0YXJ0c1sxXSk7XHJcbiAgICAgICAgbGV0IGVuZEhvdXIgPSBOdW1iZXIoZW5kc1swXSk7XHJcbiAgICAgICAgbGV0IGVuZE1pbnV0ZSA9IE51bWJlcihlbmRzWzFdKTtcclxuXHJcbiAgICAgICAgLy9OaWdodCBzaGlmdHNcclxuICAgICAgICBpZihlbmRIb3VyIDwgc3RhcnRIb3VyKXtcclxuICAgICAgICAgICAgZW5kSG91ciArPSAyNDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBlbmRIb3VyIC0gc3RhcnRIb3VyXHJcbiAgICB9XHJcblxyXG4gICAgcmVkcmF3VGFibGUod3JhcCwgc3RhcnQsIGVuZCl7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLmNhbGN1bGF0ZUludGVydmFsKHN0YXJ0LCBlbmQpO1xyXG4gICAgICAgIGNvbnN0IGRheXMgPSBbJ9Cf0L0nLCAn0JLRgicsICfQodGAJywgJ9Cn0YInLCAn0J/RgicsICfQodCxJywgJ9CS0YEnXTtcclxuICAgICAgICBjb25zdCBob3Vyc1JvdyA9IHRoaXMuY3JlYXRlSG91cnNSb3coc3RhcnQsIGNvdW50KVxyXG5cclxuICAgICAgICBpZihjb3VudCA+IDApe1xyXG4gICAgICAgICAgICB3cmFwLmFwcGVuZChob3Vyc1Jvdyk7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IDc7aSsrKXtcclxuICAgICAgICAgICAgICAgIGNvbnN0IHJvdyA9IHRoaXMuY3JlYXRlUm93KGRheXNbaV0sIGNvdW50KTtcclxuICAgICAgICAgICAgICAgIHdyYXAuYXBwZW5kKHJvdyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVjYWxjdWxhdGVSb3dzKHN0YXJ0LCBlbmQpe1xyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50YWJsZUlkKTtcclxuICAgICAgICBjb25zdCByb3dzID0gdGFibGUucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlX19yb3cnKTtcclxuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY2FsY3VsYXRlSW50ZXJ2YWwoc3RhcnQsIGVuZCk7XHJcblxyXG4gICAgICAgIGlmKGNvdW50IDw9IDApe3JldHVybn1cclxuXHJcbiAgICAgICAgY29uc3QgaG91cnNSb3cgPSB0aGlzLmNyZWF0ZUhvdXJzUm93KHN0YXJ0LCBjb3VudCk7XHJcbiAgICAgICAgcm93c1swXS5yZW1vdmUoKTtcclxuICAgICAgICB0YWJsZS5wcmVwZW5kKGhvdXJzUm93KTtcclxuXHJcbiAgICAgICAgZm9yKGxldCByID0gMTsgciA8IHJvd3MubGVuZ3RoO3IrKykge1xyXG4gICAgICAgICAgICBjb25zdCBjZWxscyA9IHJvd3Nbcl0ucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlX19jZWxsJyk7XHJcbiAgICAgICAgICAgIGlmKGNvdW50IDwgY2VsbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSBjZWxscy5sZW5ndGggLSAxOyBpID4gY291bnQ7aS0tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbHNbaV0ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZihjb3VudCA+PSBjZWxscy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gY2VsbHMubGVuZ3RoIC0gMTsgaSA8IGNvdW50O2krKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19jZWxsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy50b2dnbGVDbGFzcywgZmFsc2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJvd3Nbcl0uYXBwZW5kKGNlbGwpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBjbGVhclRhYmxlQW5pbWF0ZSgpe1xyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50YWJsZUlkKTtcclxuICAgICAgICBjb25zdCByb3dzID0gdGFibGUucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlX19yb3cnKTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgY29uc3QgY2VsbHMgPSByb3dzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgICAgICAvL3Bvc3NpYmxlIGFuaW1hdGlvbnNcclxuICAgICAgICAgICAgY29uc3QgYWxpY2VUdW1ibGluZyA9IFtcclxuICAgICAgICAgICAgICAgIHsgdHJhbnNmb3JtOiAncm90YXRlKDApIHRyYW5zbGF0ZTNEKC01MCUsIC01MCUsIDAnLCBjb2xvcjogJyMwMDAnIH0sXHJcbiAgICAgICAgICAgICAgICB7IGNvbG9yOiAnIzQzMTIzNicsIG9mZnNldDogMC4zfSxcclxuICAgICAgICAgICAgICAgIHsgdHJhbnNmb3JtOiAncm90YXRlKDM2MGRlZykgdHJhbnNsYXRlM0QoLTUwJSwgLTUwJSwgMCknLCBjb2xvcjogJyMwMDAnIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgY29uc3QgYWxpY2VUaW1pbmcgPSB7XHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy50aW1lT3V0LFxyXG4gICAgICAgICAgICAgICAgaXRlcmF0aW9uczogMVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNlbGxzLmZvckVhY2goZWxlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcclxuICAgICAgICAgICAgICAgIC8vZWxlbS5hbmltYXRlKGFsaWNlVHVtYmxpbmcsIGFsaWNlVGltaW5nKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge2VsZW0ucmVtb3ZlKCl9LCB0aGlzLnRpbWVPdXQpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZpbGxBY3RpdmVIb3VycyhjbGVhcil7XHJcbiAgICAgICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRhYmxlSWQpO1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKCcudGFibGVfX3JvdycpO1xyXG4gICAgICAgIGZvcihsZXQgciA9IDE7IHIgPCByb3dzLmxlbmd0aDtyKyspIHtcclxuICAgICAgICAgICAgY29uc3QgY2VsbHMgPSByb3dzW3JdLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgICAgICBpZihjbGVhcil7XHJcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSAxOyBpIDwgY2VsbHMubGVuZ3RoO2krKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGxzW2ldLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gMTsgaSA8IGNlbGxzLmxlbmd0aDtpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsc1tpXS5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlQ2xhc3MoZSl7XHJcbiAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJylcclxuICAgIH1cclxuXHJcbiAgICBjaGFuZ2VJbnRlcnZhbChlKXtcclxuICAgICAgICBpZihlLnRhcmdldC5pZCA9PT0gdGhpcy50YWJsZUlkICsgJ3N0YXJ0X2ludGVydmFsJyl7XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5UaW1lID0gZS50YXJnZXQudmFsdWVcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZS50YXJnZXQuaWQgPT09IHRoaXMudGFibGVJZCArICdlbmRfaW50ZXJ2YWwnKXtcclxuICAgICAgICAgICAgdGhpcy5lbmRUaW1lID0gZS50YXJnZXQudmFsdWVcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZWNhbGN1bGF0ZVJvd3ModGhpcy5iZWdpblRpbWUsIHRoaXMuZW5kVGltZSlcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbmNvbnN0IHRhYmxlID0gbmV3IFdvcmtIb3Vyc1RhYmxlKCd3b3JrX2hvdXJzX3RhYmxlJywgJ21haW5fd3JhcCcpO1xyXG50YWJsZS5jcmVhdGVUYWJsZSgpO1xyXG4vL2NvbnN0IHRhYmxlMiA9IG5ldyBXb3JrSG91cnNUYWJsZSgnd29ya19ob3Vyc190YWJsZTInLCAnbWFpbl93cmFwJyk7XHJcbi8vdGFibGUyLmNyZWF0ZVRhYmxlKCk7XHJcblxyXG4iXX0=
