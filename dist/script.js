"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var WorkHoursTable = /*#__PURE__*/function () {
  function WorkHoursTable(id, wrapId, start, end) {
    _classCallCheck(this, WorkHoursTable);

    if (!id) {
      throw Error('No table ID');
    }

    if (!wrapId) {
      throw Error('No table wrap ID');
    }

    this.beginTime = start ? start : '08:00';
    this.endTime = end ? end : '23:00';
    this.timeOut = 350;
    this.tableId = id;
    this.wrapId = document.getElementById(wrapId); //Save context for method

    this.changeInterval = this.changeInterval.bind(this);
  }

  _createClass(WorkHoursTable, [{
    key: "createTable",
    value: function createTable() {
      //Create time title
      var timeTitle = document.createElement('span');
      timeTitle.classList.add('table__time-title');
      timeTitle.innerText = 'Задать интервал таблицы'; //Create time separator

      var separator = document.createElement('span');
      separator.classList.add('table__time-separator'); //Create time fields

      var inputStart = this.createInput(this.beginTime, this.tableId + 'start_interval');
      var inputEnd = this.createInput(this.endTime, this.tableId + 'end_interval'); //Create wrapper

      var wrap = document.createElement('div');
      wrap.id = this.tableId;
      wrap.classList.add('table__wrap'); //Create time-title wrap

      var timeTitleWrap = document.createElement('div');
      timeTitleWrap.classList.add('table__time-title-wrap'); //Append blocks

      timeTitleWrap.append(timeTitle);
      timeTitleWrap.append(inputStart);
      timeTitleWrap.append(separator);
      timeTitleWrap.append(inputEnd);
      this.wrapId.append(timeTitleWrap);
      this.wrapId.append(wrap); //Render table

      this.redrawTable(wrap, this.beginTime, this.endTime);
    }
  }, {
    key: "createCell",
    value: function createCell() {
      var cell = document.createElement('div');
      cell.classList.add('table__cell');
      cell.classList.add('active');
      cell.addEventListener("click", this.toggleClass, false);
      return cell;
    }
  }, {
    key: "createRow",
    value: function createRow(wrap, day, count) {
      var row = document.createElement('div');
      row.classList.add('table__row');
      var firstCell = document.createElement('div');
      firstCell.classList.add('table__cell');
      firstCell.classList.add('table__cell--days');
      firstCell.innerHTML = "".concat(day);
      row.append(firstCell);

      for (var i = 0; i < count; i++) {
        var cell = this.createCell();
        row.append(cell);
      }

      wrap.append(row);
    }
  }, {
    key: "createInput",
    value: function createInput(value, id) {
      var input = document.createElement('input');
      input.id = id;
      input.type = 'time';
      input.min = '00:00';
      input.max = '23:30';
      input.value = value;
      input.addEventListener("change", this.changeInterval, false);
      return input;
    }
  }, {
    key: "calculateInterval",
    value: function calculateInterval(from, to) {
      var starts = from.split(':');
      var ends = to.split(':');
      var startHour = Number(starts[0]);
      var startMinute = Number(starts[1]);
      var endHour = Number(ends[0]);
      var endMinute = Number(ends[1]); //Night shifts

      if (endHour < startHour) {
        endHour += 24;
      }

      return endHour - startHour;
    }
  }, {
    key: "redrawTable",
    value: function redrawTable(wrap, start, end) {
      var count = this.calculateInterval(start, end);
      var days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];

      if (count > 0) {
        for (var i = 0; i < 7; i++) {
          this.createRow(wrap, days[i], count);
        }
      }
    }
  }, {
    key: "recalculateRows",
    value: function recalculateRows(start, end) {
      var table = document.getElementById(this.tableId);
      var rows = table.querySelectorAll('.table__row');
      var count = this.calculateInterval(start, end);

      if (count <= 0) {
        return;
      }

      for (var r = 0; r < rows.length; r++) {
        var cells = rows[r].querySelectorAll('.table__cell');

        if (count < cells.length) {
          for (var i = cells.length - 1; i > count; i--) {
            cells[i].remove();
          }
        } else if (count >= cells.length) {
          for (var _i = cells.length - 1; _i < count; _i++) {
            var cell = document.createElement('div');
            cell.classList.add('table__cell');
            cell.classList.add('active');
            cell.addEventListener("click", this.toggleClass, false);
            rows[r].append(cell);
          }
        }
      }
    }
  }, {
    key: "clearTable",
    value: function clearTable() {
      var _this = this;

      var table = document.getElementById(this.tableId);
      var rows = table.querySelectorAll('.table__row');

      for (var i = 0; i < rows.length; i++) {
        var cells = rows[i].querySelectorAll('.table__cell');
        var aliceTumbling = [{
          transform: 'rotate(0) translate3D(-50%, -50%, 0',
          color: '#000'
        }, {
          color: '#431236',
          offset: 0.3
        }, {
          transform: 'rotate(360deg) translate3D(-50%, -50%, 0)',
          color: '#000'
        }];
        var aliceTiming = {
          duration: this.timeOut,
          iterations: 1
        };
        cells.forEach(function (elem) {
          elem.classList.add('hide'); //elem.animate(aliceTumbling, aliceTiming);

          setTimeout(function () {
            elem.remove();
          }, _this.timeOut);
        });
      }
    }
  }, {
    key: "toggleClass",
    value: function toggleClass(e) {
      e.target.classList.toggle('active');
    }
  }, {
    key: "changeInterval",
    value: function changeInterval(e) {
      if (e.target.id === this.tableId + 'start_interval') {
        this.beginTime = e.target.value;
      }

      if (e.target.id === this.tableId + 'end_interval') {
        this.endTime = e.target.value;
      }

      this.recalculateRows(this.beginTime, this.endTime);
    }
  }]);

  return WorkHoursTable;
}(); // const table = new WorkHoursTable('work_hours_table', 'main_wrap');
// table.createTable();
//const table2 = new WorkHoursTable('work_hours_table2', 'main_wrap');
//table2.createTable();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3NjcmlwdC5qcyJdLCJuYW1lcyI6WyJXb3JrSG91cnNUYWJsZSIsImlkIiwid3JhcElkIiwic3RhcnQiLCJlbmQiLCJFcnJvciIsImJlZ2luVGltZSIsImVuZFRpbWUiLCJ0aW1lT3V0IiwidGFibGVJZCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJjaGFuZ2VJbnRlcnZhbCIsImJpbmQiLCJ0aW1lVGl0bGUiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiaW5uZXJUZXh0Iiwic2VwYXJhdG9yIiwiaW5wdXRTdGFydCIsImNyZWF0ZUlucHV0IiwiaW5wdXRFbmQiLCJ3cmFwIiwidGltZVRpdGxlV3JhcCIsImFwcGVuZCIsInJlZHJhd1RhYmxlIiwiY2VsbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJ0b2dnbGVDbGFzcyIsImRheSIsImNvdW50Iiwicm93IiwiZmlyc3RDZWxsIiwiaW5uZXJIVE1MIiwiaSIsImNyZWF0ZUNlbGwiLCJ2YWx1ZSIsImlucHV0IiwidHlwZSIsIm1pbiIsIm1heCIsImZyb20iLCJ0byIsInN0YXJ0cyIsInNwbGl0IiwiZW5kcyIsInN0YXJ0SG91ciIsIk51bWJlciIsInN0YXJ0TWludXRlIiwiZW5kSG91ciIsImVuZE1pbnV0ZSIsImNhbGN1bGF0ZUludGVydmFsIiwiZGF5cyIsImNyZWF0ZVJvdyIsInRhYmxlIiwicm93cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJyIiwibGVuZ3RoIiwiY2VsbHMiLCJyZW1vdmUiLCJhbGljZVR1bWJsaW5nIiwidHJhbnNmb3JtIiwiY29sb3IiLCJvZmZzZXQiLCJhbGljZVRpbWluZyIsImR1cmF0aW9uIiwiaXRlcmF0aW9ucyIsImZvckVhY2giLCJlbGVtIiwic2V0VGltZW91dCIsImUiLCJ0YXJnZXQiLCJ0b2dnbGUiLCJyZWNhbGN1bGF0ZVJvd3MiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0lBQU1BLGM7QUFFRiwwQkFBWUMsRUFBWixFQUFnQkMsTUFBaEIsRUFBd0JD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QUssQ0FBQ1MsT0FBTixDQUFjLFVBQUFDLElBQUksRUFBSTtBQUNsQkEsVUFBQUEsSUFBSSxDQUFDdEQsU0FBTCxDQUFlQyxHQUFmLENBQW1CLE1BQW5CLEVBRGtCLENBRWxCOztBQUNBc0QsVUFBQUEsVUFBVSxDQUFDLFlBQU07QUFBQ0QsWUFBQUEsSUFBSSxDQUFDVCxNQUFMO0FBQWMsV0FBdEIsRUFBd0IsS0FBSSxDQUFDckQsT0FBN0IsQ0FBVjtBQUNILFNBSkQ7QUFLSDtBQUNKOzs7Z0NBRVdnRSxDLEVBQUU7QUFDVkEsTUFBQUEsQ0FBQyxDQUFDQyxNQUFGLENBQVN6RCxTQUFULENBQW1CMEQsTUFBbkIsQ0FBMEIsUUFBMUI7QUFDSDs7O21DQUVjRixDLEVBQUU7QUFDYixVQUFHQSxDQUFDLENBQUNDLE1BQUYsQ0FBU3hFLEVBQVQsS0FBZ0IsS0FBS1EsT0FBTCxHQUFlLGdCQUFsQyxFQUFtRDtBQUMvQyxhQUFLSCxTQUFMLEdBQWlCa0UsQ0FBQyxDQUFDQyxNQUFGLENBQVNwQyxLQUExQjtBQUNIOztBQUNELFVBQUdtQyxDQUFDLENBQUNDLE1BQUYsQ0FBU3hFLEVBQVQsS0FBZ0IsS0FBS1EsT0FBTCxHQUFlLGNBQWxDLEVBQWlEO0FBQzdDLGFBQUtGLE9BQUwsR0FBZWlFLENBQUMsQ0FBQ0MsTUFBRixDQUFTcEMsS0FBeEI7QUFDSDs7QUFDRCxXQUFLc0MsZUFBTCxDQUFxQixLQUFLckUsU0FBMUIsRUFBcUMsS0FBS0MsT0FBMUM7QUFDSDs7OztLQUlMO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImNsYXNzIFdvcmtIb3Vyc1RhYmxlIHtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihpZCwgd3JhcElkLCBzdGFydCwgZW5kKSB7XHJcbiAgICAgICAgaWYoIWlkKXtcclxuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ05vIHRhYmxlIElEJyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKCF3cmFwSWQpe1xyXG4gICAgICAgICAgICB0aHJvdyBFcnJvcignTm8gdGFibGUgd3JhcCBJRCcpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmJlZ2luVGltZSA9IHN0YXJ0ID8gc3RhcnQgOiAnMDg6MDAnXHJcbiAgICAgICAgdGhpcy5lbmRUaW1lID0gZW5kID8gZW5kIDogJzIzOjAwJ1xyXG4gICAgICAgIHRoaXMudGltZU91dCA9IDM1MDtcclxuICAgICAgICB0aGlzLnRhYmxlSWQgPSBpZDtcclxuICAgICAgICB0aGlzLndyYXBJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHdyYXBJZCk7XHJcbiAgICAgICAgLy9TYXZlIGNvbnRleHQgZm9yIG1ldGhvZFxyXG4gICAgICAgIHRoaXMuY2hhbmdlSW50ZXJ2YWwgPSB0aGlzLmNoYW5nZUludGVydmFsLmJpbmQodGhpcyk7XHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlVGFibGUoKXtcclxuICAgICAgICAvL0NyZWF0ZSB0aW1lIHRpdGxlXHJcbiAgICAgICAgY29uc3QgdGltZVRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgIHRpbWVUaXRsZS5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fdGltZS10aXRsZScpO1xyXG4gICAgICAgIHRpbWVUaXRsZS5pbm5lclRleHQgPSAn0JfQsNC00LDRgtGMINC40L3RgtC10YDQstCw0Lsg0YLQsNCx0LvQuNGG0YsnO1xyXG4gICAgICAgIC8vQ3JlYXRlIHRpbWUgc2VwYXJhdG9yXHJcbiAgICAgICAgY29uc3Qgc2VwYXJhdG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpO1xyXG4gICAgICAgIHNlcGFyYXRvci5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fdGltZS1zZXBhcmF0b3InKTtcclxuICAgICAgICAvL0NyZWF0ZSB0aW1lIGZpZWxkc1xyXG4gICAgICAgIGNvbnN0IGlucHV0U3RhcnQgPSB0aGlzLmNyZWF0ZUlucHV0KHRoaXMuYmVnaW5UaW1lLCB0aGlzLnRhYmxlSWQgKyAnc3RhcnRfaW50ZXJ2YWwnKTtcclxuICAgICAgICBjb25zdCBpbnB1dEVuZCA9IHRoaXMuY3JlYXRlSW5wdXQodGhpcy5lbmRUaW1lLCB0aGlzLnRhYmxlSWQgKyAnZW5kX2ludGVydmFsJyk7XHJcbiAgICAgICAgLy9DcmVhdGUgd3JhcHBlclxyXG4gICAgICAgIGNvbnN0IHdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICB3cmFwLmlkID0gdGhpcy50YWJsZUlkO1xyXG4gICAgICAgIHdyYXAuY2xhc3NMaXN0LmFkZCgndGFibGVfX3dyYXAnKTtcclxuICAgICAgICAvL0NyZWF0ZSB0aW1lLXRpdGxlIHdyYXBcclxuICAgICAgICBjb25zdCB0aW1lVGl0bGVXcmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgdGltZVRpdGxlV3JhcC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fdGltZS10aXRsZS13cmFwJyk7XHJcbiAgICAgICAgLy9BcHBlbmQgYmxvY2tzXHJcbiAgICAgICAgdGltZVRpdGxlV3JhcC5hcHBlbmQodGltZVRpdGxlKTtcclxuICAgICAgICB0aW1lVGl0bGVXcmFwLmFwcGVuZChpbnB1dFN0YXJ0KTtcclxuICAgICAgICB0aW1lVGl0bGVXcmFwLmFwcGVuZChzZXBhcmF0b3IpO1xyXG4gICAgICAgIHRpbWVUaXRsZVdyYXAuYXBwZW5kKGlucHV0RW5kKTtcclxuICAgICAgICB0aGlzLndyYXBJZC5hcHBlbmQodGltZVRpdGxlV3JhcCk7XHJcbiAgICAgICAgdGhpcy53cmFwSWQuYXBwZW5kKHdyYXApO1xyXG4gICAgICAgIC8vUmVuZGVyIHRhYmxlXHJcbiAgICAgICAgdGhpcy5yZWRyYXdUYWJsZSh3cmFwLCB0aGlzLmJlZ2luVGltZSwgdGhpcy5lbmRUaW1lKVxyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUNlbGwoKXtcclxuICAgICAgICBjb25zdCBjZWxsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7XHJcbiAgICAgICAgY2VsbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgdGhpcy50b2dnbGVDbGFzcywgZmFsc2UpO1xyXG5cclxuICAgICAgICByZXR1cm4gY2VsbDtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVSb3cod3JhcCwgZGF5LCBjb3VudCl7XHJcbiAgICAgICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgcm93LmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19yb3cnKTtcclxuICAgICAgICBjb25zdCBmaXJzdENlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBmaXJzdENlbGwuY2xhc3NMaXN0LmFkZCgndGFibGVfX2NlbGwnKTtcclxuICAgICAgICBmaXJzdENlbGwuY2xhc3NMaXN0LmFkZCgndGFibGVfX2NlbGwtLWRheXMnKTtcclxuICAgICAgICBmaXJzdENlbGwuaW5uZXJIVE1MID0gYCR7ZGF5fWA7XHJcbiAgICAgICAgcm93LmFwcGVuZChmaXJzdENlbGwpO1xyXG4gICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IGNvdW50O2krKyl7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGwgPSB0aGlzLmNyZWF0ZUNlbGwoKTtcclxuICAgICAgICAgICAgcm93LmFwcGVuZChjZWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgd3JhcC5hcHBlbmQocm93KTtcclxuICAgIH1cclxuXHJcbiAgICBjcmVhdGVJbnB1dCh2YWx1ZSwgaWQpe1xyXG4gICAgICAgIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICBpbnB1dC5pZCA9IGlkO1xyXG4gICAgICAgIGlucHV0LnR5cGUgPSAndGltZSc7XHJcbiAgICAgICAgaW5wdXQubWluID0gJzAwOjAwJztcclxuICAgICAgICBpbnB1dC5tYXggPSAnMjM6MzAnO1xyXG4gICAgICAgIGlucHV0LnZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgaW5wdXQuYWRkRXZlbnRMaXN0ZW5lcihcImNoYW5nZVwiLCB0aGlzLmNoYW5nZUludGVydmFsLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHJldHVybiBpbnB1dDtcclxuICAgIH1cclxuXHJcbiAgICBjYWxjdWxhdGVJbnRlcnZhbChmcm9tLCB0byl7XHJcbiAgICAgICAgY29uc3Qgc3RhcnRzID0gZnJvbS5zcGxpdCgnOicpO1xyXG4gICAgICAgIGNvbnN0IGVuZHMgPSB0by5zcGxpdCgnOicpO1xyXG4gICAgICAgIGxldCBzdGFydEhvdXIgPSBOdW1iZXIoc3RhcnRzWzBdKTtcclxuICAgICAgICBsZXQgc3RhcnRNaW51dGUgPSBOdW1iZXIoc3RhcnRzWzFdKTtcclxuICAgICAgICBsZXQgZW5kSG91ciA9IE51bWJlcihlbmRzWzBdKTtcclxuICAgICAgICBsZXQgZW5kTWludXRlID0gTnVtYmVyKGVuZHNbMV0pO1xyXG5cclxuICAgICAgICAvL05pZ2h0IHNoaWZ0c1xyXG4gICAgICAgIGlmKGVuZEhvdXIgPCBzdGFydEhvdXIpe1xyXG4gICAgICAgICAgICBlbmRIb3VyICs9IDI0O1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGVuZEhvdXIgLSBzdGFydEhvdXJcclxuICAgIH1cclxuXHJcbiAgICByZWRyYXdUYWJsZSh3cmFwLCBzdGFydCwgZW5kKXtcclxuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY2FsY3VsYXRlSW50ZXJ2YWwoc3RhcnQsIGVuZCk7XHJcbiAgICAgICAgY29uc3QgZGF5cyA9IFsn0J/QvScsICfQktGCJywgJ9Ch0YAnLCAn0KfRgicsICfQn9GCJywgJ9Ch0LEnLCAn0JLRgSddO1xyXG4gICAgICAgIGlmKGNvdW50ID4gMCl7XHJcbiAgICAgICAgICAgIGZvcihsZXQgaSA9IDA7aSA8IDc7aSsrKXtcclxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlUm93KHdyYXAsIGRheXNbaV0sIGNvdW50KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZWNhbGN1bGF0ZVJvd3Moc3RhcnQsIGVuZCl7XHJcbiAgICAgICAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCh0aGlzLnRhYmxlSWQpO1xyXG4gICAgICAgIGNvbnN0IHJvd3MgPSB0YWJsZS5xdWVyeVNlbGVjdG9yQWxsKCcudGFibGVfX3JvdycpO1xyXG4gICAgICAgIGNvbnN0IGNvdW50ID0gdGhpcy5jYWxjdWxhdGVJbnRlcnZhbChzdGFydCwgZW5kKTtcclxuXHJcbiAgICAgICAgaWYoY291bnQgPD0gMCl7cmV0dXJufVxyXG5cclxuICAgICAgICBmb3IobGV0IHIgPSAwOyByIDwgcm93cy5sZW5ndGg7cisrKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGxzID0gcm93c1tyXS5xdWVyeVNlbGVjdG9yQWxsKCcudGFibGVfX2NlbGwnKTtcclxuICAgICAgICAgICAgaWYoY291bnQgPCBjZWxscy5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIGZvcihsZXQgaSA9IGNlbGxzLmxlbmd0aCAtIDE7IGkgPiBjb3VudDtpLS0pIHtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsc1tpXS5yZW1vdmUoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIGlmKGNvdW50ID49IGNlbGxzLmxlbmd0aCl7XHJcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSBjZWxscy5sZW5ndGggLSAxOyBpIDwgY291bnQ7aSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGwuY2xhc3NMaXN0LmFkZCgndGFibGVfX2NlbGwnKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbGwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMudG9nZ2xlQ2xhc3MsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICByb3dzW3JdLmFwcGVuZChjZWxsKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICB9XHJcblxyXG4gICAgY2xlYXJUYWJsZSgpe1xyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGhpcy50YWJsZUlkKTtcclxuICAgICAgICBjb25zdCByb3dzID0gdGFibGUucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlX19yb3cnKTtcclxuICAgICAgICBmb3IobGV0IGkgPSAwOyBpIDwgcm93cy5sZW5ndGg7aSsrKXtcclxuICAgICAgICAgICAgY29uc3QgY2VsbHMgPSByb3dzW2ldLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgICAgICBjb25zdCBhbGljZVR1bWJsaW5nID0gW1xyXG4gICAgICAgICAgICAgICAgeyB0cmFuc2Zvcm06ICdyb3RhdGUoMCkgdHJhbnNsYXRlM0QoLTUwJSwgLTUwJSwgMCcsIGNvbG9yOiAnIzAwMCcgfSxcclxuICAgICAgICAgICAgICAgIHsgY29sb3I6ICcjNDMxMjM2Jywgb2Zmc2V0OiAwLjN9LFxyXG4gICAgICAgICAgICAgICAgeyB0cmFuc2Zvcm06ICdyb3RhdGUoMzYwZGVnKSB0cmFuc2xhdGUzRCgtNTAlLCAtNTAlLCAwKScsIGNvbG9yOiAnIzAwMCcgfVxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICBjb25zdCBhbGljZVRpbWluZyA9IHtcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiB0aGlzLnRpbWVPdXQsXHJcbiAgICAgICAgICAgICAgICBpdGVyYXRpb25zOiAxXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY2VsbHMuZm9yRWFjaChlbGVtID0+IHtcclxuICAgICAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LmFkZCgnaGlkZScpO1xyXG4gICAgICAgICAgICAgICAgLy9lbGVtLmFuaW1hdGUoYWxpY2VUdW1ibGluZywgYWxpY2VUaW1pbmcpO1xyXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7ZWxlbS5yZW1vdmUoKX0sIHRoaXMudGltZU91dClcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdG9nZ2xlQ2xhc3MoZSl7XHJcbiAgICAgICAgZS50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJylcclxuICAgIH1cclxuXHJcbiAgICBjaGFuZ2VJbnRlcnZhbChlKXtcclxuICAgICAgICBpZihlLnRhcmdldC5pZCA9PT0gdGhpcy50YWJsZUlkICsgJ3N0YXJ0X2ludGVydmFsJyl7XHJcbiAgICAgICAgICAgIHRoaXMuYmVnaW5UaW1lID0gZS50YXJnZXQudmFsdWVcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoZS50YXJnZXQuaWQgPT09IHRoaXMudGFibGVJZCArICdlbmRfaW50ZXJ2YWwnKXtcclxuICAgICAgICAgICAgdGhpcy5lbmRUaW1lID0gZS50YXJnZXQudmFsdWVcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZWNhbGN1bGF0ZVJvd3ModGhpcy5iZWdpblRpbWUsIHRoaXMuZW5kVGltZSlcclxuICAgIH1cclxuXHJcbn1cclxuXHJcbi8vIGNvbnN0IHRhYmxlID0gbmV3IFdvcmtIb3Vyc1RhYmxlKCd3b3JrX2hvdXJzX3RhYmxlJywgJ21haW5fd3JhcCcpO1xyXG4vLyB0YWJsZS5jcmVhdGVUYWJsZSgpO1xyXG4vL2NvbnN0IHRhYmxlMiA9IG5ldyBXb3JrSG91cnNUYWJsZSgnd29ya19ob3Vyc190YWJsZTInLCAnbWFpbl93cmFwJyk7XHJcbi8vdGFibGUyLmNyZWF0ZVRhYmxlKCk7XHJcblxyXG4iXX0=
