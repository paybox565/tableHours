"use strict";

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }

function _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }

var WorkHoursTable = /*#__PURE__*/function () {
  function WorkHoursTable(wrap, start, end) {
    _classCallCheck(this, WorkHoursTable);

    this.beginTime = start ? start : '07:00';
    this.endTime = end ? end : '17:00';
    this.timeOut = 350; //Save context for method

    this.changeInterval = this.changeInterval.bind(this);
  }

  _createClass(WorkHoursTable, [{
    key: "createTable",
    value: function createTable() {
      var wrap = document.createElement('div');
      wrap.id = 'work_hours_table';
      wrap.classList.add('table__wrap');
      document.body.append(wrap); //Create time fields

      this.createInput(document.body, this.beginTime, 'start_interval');
      this.createInput(document.body, this.endTime, 'end_interval');
      this.redrawTable(wrap, this.beginTime, this.endTime);
    }
  }, {
    key: "createCell",
    value: function createCell() {
      var cell = document.createElement('div');
      cell.classList.add('table__cell');
      cell.classList.add('active');
      cell.addEventListener("click", this.toggleClass, false);
      return cell;
    }
  }, {
    key: "createRow",
    value: function createRow(wrap, day, count) {
      var row = document.createElement('div');
      row.classList.add('table__row');
      var firstCell = document.createElement('div');
      firstCell.classList.add('table__cell');
      firstCell.classList.add('table__cell--days');
      firstCell.innerHTML = "".concat(day);
      row.append(firstCell);

      for (var i = 0; i < count; i++) {
        var cell = this.createCell();
        row.append(cell);
      }

      wrap.append(row);
    }
  }, {
    key: "createInput",
    value: function createInput(wrap, value, id) {
      var input = document.createElement('input');
      input.id = id;
      input.type = 'time';
      input.min = '00:00';
      input.max = '23:30';
      input.value = value;
      input.addEventListener("change", this.changeInterval, false);
      wrap.append(input);
    }
  }, {
    key: "calculateInterval",
    value: function calculateInterval(from, to) {
      var starts = from.split(':');
      var ends = to.split(':');
      return Number(ends[0]) - Number(starts[0]);
    }
  }, {
    key: "redrawTable",
    value: function redrawTable(wrap, start, end) {
      var count = this.calculateInterval(start, end);
      var days = ['Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс'];

      if (count > 0) {
        for (var i = 0; i < 7; i++) {
          this.createRow(wrap, days[i], count);
        }
      }
    }
  }, {
    key: "recalculateRows",
    value: function recalculateRows(start, end) {
      var table = document.getElementById('work_hours_table');
      var rows = table.querySelectorAll('.table__row');
      var count = this.calculateInterval(start, end);

      if (count <= 0) {
        return;
      }

      for (var r = 0; r < rows.length; r++) {
        var cells = rows[r].querySelectorAll('.table__cell');

        if (count < cells.length) {
          for (var i = cells.length - 1; i > count; i--) {
            cells[i].remove();
          }
        } else if (count >= cells.length) {
          for (var _i = cells.length - 1; _i < count; _i++) {
            var cell = document.createElement('div');
            cell.classList.add('table__cell');
            cell.classList.add('active');
            cell.addEventListener("click", this.toggleClass, false);
            rows[r].append(cell);
          }
        }
      }
    }
  }, {
    key: "clearTable",
    value: function clearTable() {
      var _this = this;

      var table = document.getElementById('work_hours_table');
      var rows = table.querySelectorAll('.table__row');

      for (var i = 0; i < rows.length; i++) {
        var cells = rows[i].querySelectorAll('.table__cell');
        var aliceTumbling = [{
          transform: 'rotate(0) translate3D(-50%, -50%, 0',
          color: '#000'
        }, {
          color: '#431236',
          offset: 0.3
        }, {
          transform: 'rotate(360deg) translate3D(-50%, -50%, 0)',
          color: '#000'
        }];
        var aliceTiming = {
          duration: this.timeOut,
          iterations: 1
        };
        cells.forEach(function (elem) {
          elem.classList.add('hide'); //elem.animate(aliceTumbling, aliceTiming);

          setTimeout(function () {
            elem.remove();
          }, _this.timeOut);
        });
      }
    }
  }, {
    key: "toggleClass",
    value: function toggleClass(e) {
      e.target.classList.toggle('active');
    }
  }, {
    key: "changeInterval",
    value: function changeInterval(e) {
      if (e.target.id === 'start_interval') {
        this.beginTime = e.target.value;
      }

      if (e.target.id === 'end_interval') {
        this.endTime = e.target.value;
      }

      this.recalculateRows(this.beginTime, this.endTime);
    }
  }]);

  return WorkHoursTable;
}();

var table = new WorkHoursTable();
table.createTable();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpzL3NjcmlwdC5qcyJdLCJuYW1lcyI6WyJXb3JrSG91cnNUYWJsZSIsIndyYXAiLCJzdGFydCIsImVuZCIsImJlZ2luVGltZSIsImVuZFRpbWUiLCJ0aW1lT3V0IiwiY2hhbmdlSW50ZXJ2YWwiLCJiaW5kIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwiaWQiLCJjbGFzc0xpc3QiLCJhZGQiLCJib2R5IiwiYXBwZW5kIiwiY3JlYXRlSW5wdXQiLCJyZWRyYXdUYWJsZSIsImNlbGwiLCJhZGRFdmVudExpc3RlbmVyIiwidG9nZ2xlQ2xhc3MiLCJkYXkiLCJjb3VudCIsInJvdyIsImZpcnN0Q2VsbCIsImlubmVySFRNTCIsImkiLCJjcmVhdGVDZWxsIiwidmFsdWUiLCJpbnB1dCIsInR5cGUiLCJtaW4iLCJtYXgiLCJmcm9tIiwidG8iLCJzdGFydHMiLCJzcGxpdCIsImVuZHMiLCJOdW1iZXIiLCJjYWxjdWxhdGVJbnRlcnZhbCIsImRheXMiLCJjcmVhdGVSb3ciLCJ0YWJsZSIsImdldEVsZW1lbnRCeUlkIiwicm93cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJyIiwibGVuZ3RoIiwiY2VsbHMiLCJyZW1vdmUiLCJhbGljZVR1bWJsaW5nIiwidHJhbnNmb3JtIiwiY29sb3IiLCJvZmZzZXQiLCJhbGljZVRpbWluZyIsImR1cmF0aW9uIiwiaXRlcmF0aW9ucyIsImZvckVhY2giLCJlbGVtIiwic2V0VGltZW91dCIsImUiLCJ0YXJnZXQiLCJ0b2dnbGUiLCJyZWNhbGN1bGF0ZVJvd3MiLCJjcmVhdGVUYWJsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7SUFBTUEsYztBQUVGLDBCQUFZQyxJQUFaLEVBQWtCQyxLQUFsQixFQUF5QkMsR0FBekIsRUFBOEI7QUFBQTs7QUFDMUIsU0FBS0MsU0FBTCxHQUFpQkYsS0FBSyxHQUFHQSxLQUFILEdBQVcsT0FBakM7QUFDQSxTQUFLRyxPQUFMLEdBQWVGLEdBQUcsR0FBR0EsR0FBSCxHQUFTLE9BQTNCO0FBQ0EsU0FBS0cs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Z0IsZ0JBQW5CLEVBQW9DO0FBQ2hDLGFBQUtQLFNBQUwsR0FBaUJ3RCxDQUFDLENBQUNDLE1BQUYsQ0FBU2pDLEtBQTFCO0FBQ0g7O0FBQ0QsVUFBR2dDLENBQUMsQ0FBQ0MsTUFBRixDQUFTbEQsRUFBVCxLQUFnQixjQUFuQixFQUFrQztBQUM5QixhQUFLTixPQUFMLEdBQWV1RCxDQUFDLENBQUNDLE1BQUYsQ0FBU2pDLEtBQXhCO0FBQ0g7O0FBQ0QsV0FBS21DLGVBQUwsQ0FBcUIsS0FBSzNELFNBQTFCLEVBQXFDLEtBQUtDLE9BQTFDO0FBQ0g7Ozs7OztBQUlMLElBQU1xQyxLQUFLLEdBQUcsSUFBSTFDLGNBQUosRUFBZDtBQUNBMEMsS0FBSyxDQUFDc0IsV0FBTiIsImZpbGUiOiJzY3JpcHQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJjbGFzcyBXb3JrSG91cnNUYWJsZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3Iod3JhcCwgc3RhcnQsIGVuZCkge1xyXG4gICAgICAgIHRoaXMuYmVnaW5UaW1lID0gc3RhcnQgPyBzdGFydCA6ICcwNzowMCdcclxuICAgICAgICB0aGlzLmVuZFRpbWUgPSBlbmQgPyBlbmQgOiAnMTc6MDAnXHJcbiAgICAgICAgdGhpcy50aW1lT3V0ID0gMzUwO1xyXG4gICAgICAgIC8vU2F2ZSBjb250ZXh0IGZvciBtZXRob2RcclxuICAgICAgICB0aGlzLmNoYW5nZUludGVydmFsID0gdGhpcy5jaGFuZ2VJbnRlcnZhbC5iaW5kKHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVRhYmxlKCl7XHJcbiAgICAgICAgY29uc3Qgd3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHdyYXAuaWQgPSAnd29ya19ob3Vyc190YWJsZSc7XHJcbiAgICAgICAgd3JhcC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fd3JhcCcpO1xyXG4gICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kKHdyYXApO1xyXG4gICAgICAgIC8vQ3JlYXRlIHRpbWUgZmllbGRzXHJcbiAgICAgICAgdGhpcy5jcmVhdGVJbnB1dChkb2N1bWVudC5ib2R5LCB0aGlzLmJlZ2luVGltZSwgJ3N0YXJ0X2ludGVydmFsJyk7XHJcbiAgICAgICAgdGhpcy5jcmVhdGVJbnB1dChkb2N1bWVudC5ib2R5LCB0aGlzLmVuZFRpbWUsICdlbmRfaW50ZXJ2YWwnKTtcclxuICAgICAgICB0aGlzLnJlZHJhd1RhYmxlKHdyYXAsIHRoaXMuYmVnaW5UaW1lLCB0aGlzLmVuZFRpbWUpXHJcbiAgICB9XHJcblxyXG4gICAgY3JlYXRlQ2VsbCgpe1xyXG4gICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19jZWxsJyk7XHJcbiAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnRvZ2dsZUNsYXNzLCBmYWxzZSk7XHJcblxyXG4gICAgICAgIHJldHVybiBjZWxsO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZVJvdyh3cmFwLCBkYXksIGNvdW50KXtcclxuICAgICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICByb3cuY2xhc3NMaXN0LmFkZCgndGFibGVfX3JvdycpO1xyXG4gICAgICAgIGNvbnN0IGZpcnN0Q2VsbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIGZpcnN0Q2VsbC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fY2VsbCcpO1xyXG4gICAgICAgIGZpcnN0Q2VsbC5jbGFzc0xpc3QuYWRkKCd0YWJsZV9fY2VsbC0tZGF5cycpO1xyXG4gICAgICAgIGZpcnN0Q2VsbC5pbm5lckhUTUwgPSBgJHtkYXl9YDtcclxuICAgICAgICByb3cuYXBwZW5kKGZpcnN0Q2VsbCk7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDtpIDwgY291bnQ7aSsrKXtcclxuICAgICAgICAgICAgY29uc3QgY2VsbCA9IHRoaXMuY3JlYXRlQ2VsbCgpO1xyXG4gICAgICAgICAgICByb3cuYXBwZW5kKGNlbGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB3cmFwLmFwcGVuZChyb3cpO1xyXG4gICAgfVxyXG5cclxuICAgIGNyZWF0ZUlucHV0KHdyYXAsIHZhbHVlLCBpZCl7XHJcbiAgICAgICAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gICAgICAgIGlucHV0LmlkID0gaWQ7XHJcbiAgICAgICAgaW5wdXQudHlwZSA9ICd0aW1lJztcclxuICAgICAgICBpbnB1dC5taW4gPSAnMDA6MDAnO1xyXG4gICAgICAgIGlucHV0Lm1heCA9ICcyMzozMCc7XHJcbiAgICAgICAgaW5wdXQudmFsdWUgPSB2YWx1ZTtcclxuICAgICAgICBpbnB1dC5hZGRFdmVudExpc3RlbmVyKFwiY2hhbmdlXCIsIHRoaXMuY2hhbmdlSW50ZXJ2YWwsIGZhbHNlKTtcclxuICAgICAgICB3cmFwLmFwcGVuZChpbnB1dCk7XHJcbiAgICB9XHJcblxyXG4gICAgY2FsY3VsYXRlSW50ZXJ2YWwoZnJvbSwgdG8pe1xyXG4gICAgICAgIGNvbnN0IHN0YXJ0cyA9IGZyb20uc3BsaXQoJzonKTtcclxuICAgICAgICBjb25zdCBlbmRzID0gdG8uc3BsaXQoJzonKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIE51bWJlcihlbmRzWzBdKSAtIE51bWJlcihzdGFydHNbMF0pXHJcbiAgICB9XHJcblxyXG4gICAgcmVkcmF3VGFibGUod3JhcCwgc3RhcnQsIGVuZCl7XHJcbiAgICAgICAgY29uc3QgY291bnQgPSB0aGlzLmNhbGN1bGF0ZUludGVydmFsKHN0YXJ0LCBlbmQpO1xyXG4gICAgICAgIGNvbnN0IGRheXMgPSBbJ9Cf0L0nLCAn0JLRgicsICfQodGAJywgJ9Cn0YInLCAn0J/RgicsICfQodCxJywgJ9CS0YEnXTtcclxuICAgICAgICBpZihjb3VudCA+IDApe1xyXG4gICAgICAgICAgICBmb3IobGV0IGkgPSAwO2kgPCA3O2krKyl7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZVJvdyh3cmFwLCBkYXlzW2ldLCBjb3VudCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcmVjYWxjdWxhdGVSb3dzKHN0YXJ0LCBlbmQpe1xyXG4gICAgICAgIGNvbnN0IHRhYmxlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3dvcmtfaG91cnNfdGFibGUnKTtcclxuICAgICAgICBjb25zdCByb3dzID0gdGFibGUucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlX19yb3cnKTtcclxuICAgICAgICBjb25zdCBjb3VudCA9IHRoaXMuY2FsY3VsYXRlSW50ZXJ2YWwoc3RhcnQsIGVuZCk7XHJcblxyXG4gICAgICAgIGlmKGNvdW50IDw9IDApe3JldHVybn1cclxuXHJcbiAgICAgICAgZm9yKGxldCByID0gMDsgciA8IHJvd3MubGVuZ3RoO3IrKykge1xyXG4gICAgICAgICAgICBjb25zdCBjZWxscyA9IHJvd3Nbcl0ucXVlcnlTZWxlY3RvckFsbCgnLnRhYmxlX19jZWxsJyk7XHJcbiAgICAgICAgICAgIGlmKGNvdW50IDwgY2VsbHMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBmb3IobGV0IGkgPSBjZWxscy5sZW5ndGggLSAxOyBpID4gY291bnQ7aS0tKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbHNbaV0ucmVtb3ZlKCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZihjb3VudCA+PSBjZWxscy5sZW5ndGgpe1xyXG4gICAgICAgICAgICAgICAgZm9yKGxldCBpID0gY2VsbHMubGVuZ3RoIC0gMTsgaSA8IGNvdW50O2krKykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsLmNsYXNzTGlzdC5hZGQoJ3RhYmxlX19jZWxsJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgY2VsbC5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgICAgICAgICAgICAgICAgICBjZWxsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCB0aGlzLnRvZ2dsZUNsYXNzLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcm93c1tyXS5hcHBlbmQoY2VsbCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGNsZWFyVGFibGUoKXtcclxuICAgICAgICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd3b3JrX2hvdXJzX3RhYmxlJyk7XHJcbiAgICAgICAgY29uc3Qgcm93cyA9IHRhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoJy50YWJsZV9fcm93Jyk7XHJcbiAgICAgICAgZm9yKGxldCBpID0gMDsgaSA8IHJvd3MubGVuZ3RoO2krKyl7XHJcbiAgICAgICAgICAgIGNvbnN0IGNlbGxzID0gcm93c1tpXS5xdWVyeVNlbGVjdG9yQWxsKCcudGFibGVfX2NlbGwnKTtcclxuICAgICAgICAgICAgY29uc3QgYWxpY2VUdW1ibGluZyA9IFtcclxuICAgICAgICAgICAgICAgIHsgdHJhbnNmb3JtOiAncm90YXRlKDApIHRyYW5zbGF0ZTNEKC01MCUsIC01MCUsIDAnLCBjb2xvcjogJyMwMDAnIH0sXHJcbiAgICAgICAgICAgICAgICB7IGNvbG9yOiAnIzQzMTIzNicsIG9mZnNldDogMC4zfSxcclxuICAgICAgICAgICAgICAgIHsgdHJhbnNmb3JtOiAncm90YXRlKDM2MGRlZykgdHJhbnNsYXRlM0QoLTUwJSwgLTUwJSwgMCknLCBjb2xvcjogJyMwMDAnIH1cclxuICAgICAgICAgICAgXTtcclxuICAgICAgICAgICAgY29uc3QgYWxpY2VUaW1pbmcgPSB7XHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogdGhpcy50aW1lT3V0LFxyXG4gICAgICAgICAgICAgICAgaXRlcmF0aW9uczogMVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNlbGxzLmZvckVhY2goZWxlbSA9PiB7XHJcbiAgICAgICAgICAgICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2hpZGUnKTtcclxuICAgICAgICAgICAgICAgIC8vZWxlbS5hbmltYXRlKGFsaWNlVHVtYmxpbmcsIGFsaWNlVGltaW5nKTtcclxuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge2VsZW0ucmVtb3ZlKCl9LCB0aGlzLnRpbWVPdXQpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRvZ2dsZUNsYXNzKGUpe1xyXG4gICAgICAgIGUudGFyZ2V0LmNsYXNzTGlzdC50b2dnbGUoJ2FjdGl2ZScpXHJcbiAgICB9XHJcblxyXG4gICAgY2hhbmdlSW50ZXJ2YWwoZSl7XHJcbiAgICAgICAgaWYoZS50YXJnZXQuaWQgPT09ICdzdGFydF9pbnRlcnZhbCcpe1xyXG4gICAgICAgICAgICB0aGlzLmJlZ2luVGltZSA9IGUudGFyZ2V0LnZhbHVlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKGUudGFyZ2V0LmlkID09PSAnZW5kX2ludGVydmFsJyl7XHJcbiAgICAgICAgICAgIHRoaXMuZW5kVGltZSA9IGUudGFyZ2V0LnZhbHVlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMucmVjYWxjdWxhdGVSb3dzKHRoaXMuYmVnaW5UaW1lLCB0aGlzLmVuZFRpbWUpXHJcbiAgICB9XHJcblxyXG59XHJcblxyXG5jb25zdCB0YWJsZSA9IG5ldyBXb3JrSG91cnNUYWJsZSgpO1xyXG50YWJsZS5jcmVhdGVUYWJsZSgpO1xyXG5cclxuIl19
